{"version":3,"file":"Locales.js","sourceRoot":"","sources":["../../src/ios/Locales.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,gEAAuC;AACvC,6CAA+B;AAC/B,+BAA4B;AAG5B,4DAAqD;AACrD,iDAK2B;AAE3B,SAAgB,UAAU,CAAC,MAAkB;;IAC3C,aAAO,MAAM,CAAC,OAAO,mCAAI,IAAI,CAAC;AAChC,CAAC;AAFD,gCAEC;AAEM,KAAK,UAAU,eAAe,CAAC,MAAkB,EAAE,WAAmB;IAC3E,MAAM,OAAO,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;IACnC,IAAI,CAAC,OAAO,EAAE;QACZ,OAAO;KACR;IACD,+DAA+D;IAC/D,MAAM,UAAU,GAAG,MAAM,uBAAuB,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;IAEvE,IAAI,OAAO,GAAG,sBAAU,CAAC,WAAW,CAAC,CAAC;IACtC,MAAM,WAAW,GAAG,0BAAc,CAAC,WAAW,CAAC,CAAC;IAChD,MAAM,mBAAmB,GAAG,WAAI,CAAC,WAAW,EAAE,KAAK,EAAE,WAAW,EAAE,YAAY,CAAC,CAAC;IAEhF,mFAAmF;IACnF,MAAM,UAAU,GAAG,mBAAmB,CAAC;IAEvC,KAAK,MAAM,CAAC,IAAI,EAAE,eAAe,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;QAChE,MAAM,GAAG,GAAG,WAAI,CAAC,mBAAmB,EAAE,GAAG,IAAI,QAAQ,CAAC,CAAC;QACvD,MAAM,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;QACxB,MAAM,OAAO,GAAG,WAAI,CAAC,GAAG,EAAE,UAAU,CAAC,CAAC;QACtC,MAAM,MAAM,GAAG,EAAE,CAAC;QAClB,KAAK,MAAM,CAAC,QAAQ,EAAE,YAAY,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,EAAE;YACtE,MAAM,CAAC,IAAI,CAAC,GAAG,QAAQ,OAAO,YAAY,IAAI,CAAC,CAAC;SACjD;QACD,qCAAqC;QACrC,MAAM,EAAE,CAAC,SAAS,CAAC,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAE/C,+BAA+B;QAC/B,MAAM,KAAK,GAAG,kCAAsB,CAAC,OAAO,EAAE,GAAG,WAAW,eAAe,IAAI,QAAQ,CAAC,CAAC;QAEzF,wCAAwC;QACxC,IAAI,EAAC,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,QAAQ,CAAC,IAAI,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE,CAAC,OAAO,KAAK,UAAU,EAAC,EAAE;YAClE,mDAAmD;YACnD,OAAO,GAAG,0BAAc,CAAC,OAAO,EAAE,GAAG,WAAW,eAAe,IAAI,QAAQ,EAAE,OAAO,CAAC,CAAC;SACvF;KACF;IAED,2CAA2C;IAC3C,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,QAAQ,EAAE,OAAO,CAAC,SAAS,EAAE,CAAC,CAAC;AAC1D,CAAC;AAtCD,0CAsCC;AAID,KAAK,UAAU,uBAAuB,CACpC,WAAmB,EACnB,KAA6B;IAE7B,MAAM,OAAO,GAAc,EAAE,CAAC;IAC9B,KAAK,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;QAChD,IAAI;YACF,OAAO,CAAC,IAAI,CAAC,GAAG,MAAM,mBAAQ,CAAC,SAAS,CAAC,WAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC,CAAC;SACnE;QAAC,OAAO,CAAC,EAAE;YACV,mDAAmD;YACnD,iCAAa,CACX,WAAW,IAAI,EAAE,EACjB,qDAAqD,IAAI,EAAE,EAC3D,uEAAuE,CACxE,CAAC;SACH;KACF;IAED,OAAO,OAAO,CAAC;AACjB,CAAC","sourcesContent":["import JsonFile from '@expo/json-file';\nimport * as fs from 'fs-extra';\nimport { join } from 'path';\n\nimport { ExpoConfig } from '../Config.types';\nimport { addWarningIOS } from '../WarningAggregator';\nimport {\n  addFileToGroup,\n  ensureGroupRecursively,\n  getPbxproj,\n  getProjectName,\n} from './utils/Xcodeproj';\n\nexport function getLocales(config: ExpoConfig): Record<string, string> | null {\n  return config.locales ?? null;\n}\n\nexport async function setLocalesAsync(config: ExpoConfig, projectRoot: string): Promise<void> {\n  const locales = getLocales(config);\n  if (!locales) {\n    return;\n  }\n  // possibly validate CFBundleAllowMixedLocalizations is enabled\n  const localesMap = await getResolvedLocalesAsync(projectRoot, locales);\n\n  let project = getPbxproj(projectRoot);\n  const projectName = getProjectName(projectRoot);\n  const supportingDirectory = join(projectRoot, 'ios', projectName, 'Supporting');\n\n  // TODO: Should we delete all before running? Revisit after we land on a lock file.\n  const stringName = 'InfoPlist.strings';\n\n  for (const [lang, localizationObj] of Object.entries(localesMap)) {\n    const dir = join(supportingDirectory, `${lang}.lproj`);\n    await fs.ensureDir(dir);\n    const strings = join(dir, stringName);\n    const buffer = [];\n    for (const [plistKey, localVersion] of Object.entries(localizationObj)) {\n      buffer.push(`${plistKey} = \"${localVersion}\";`);\n    }\n    // Write the file to the file system.\n    await fs.writeFile(strings, buffer.join('\\n'));\n\n    // deep find the correct folder\n    const group = ensureGroupRecursively(project, `${projectName}/Supporting/${lang}.lproj`);\n\n    // Ensure the file doesn't already exist\n    if (!group?.children.some(({ comment }) => comment === stringName)) {\n      // Only write the file if it doesn't already exist.\n      project = addFileToGroup(strings, `${projectName}/Supporting/${lang}.lproj`, project);\n    }\n  }\n\n  // Sync the Xcode project with the changes.\n  fs.writeFileSync(project.filepath, project.writeSync());\n}\n\ntype LocaleMap = Record<string, any>;\n\nasync function getResolvedLocalesAsync(\n  projectRoot: string,\n  input: Record<string, string>\n): Promise<LocaleMap> {\n  const locales: LocaleMap = {};\n  for (const [lang, path] of Object.entries(input)) {\n    try {\n      locales[lang] = await JsonFile.readAsync(join(projectRoot, path));\n    } catch (e) {\n      // Add a warning when a json file cannot be parsed.\n      addWarningIOS(\n        `locales-${lang}`,\n        `Failed to parse JSON of locale file for language: ${lang}`,\n        'https://docs.expo.io/distribution/app-stores/#localizing-your-ios-app'\n      );\n    }\n  }\n\n  return locales;\n}\n"]}